# 리액트 컴포넌트의 동적 로딩 최적화 적용하기

리액트는 기본적으로 클라이언트 사이드 랜더링 방식
그래서 서버에서 빈 페이지를 먼저 클라이언트로 보내줌
클라이언트가 빈 화면을 받아서, 여기서 js 코드로 화면 랜더링함!

### 동적로딩 최적화란?

클라이언트가 서버에서 받은 빈페이지에 JS 랜더링 할 때,
JS 용량이 엄청나게 크다면? 그만큼 로딩 시간이 길어져서 사용자는 ' 빈화면' 을 볼 수 있음 !
그래서 이런 동적 로딩을 최적화 하기 위한 리액트의 방법은 두가지가 있다 !
바로 **lazy** , **Suspense**

## 1. lazy

> 컴포넌트를 바로 불러오지 않고, 실제로 그 컴포넌트가 필요할 때 불러옴

불러오는 방법은 `import` 할 때, `lazy()` 함수 사용하기

```jsx
const Main = lazy(() => import("./Main.jsx"));
```

---

## 2. Suspense

> lazy방식으로 컴포넌트를 불러오는 동안 , 사용자에게 보여줄 임시 화면 설정

```jsx
<Suspense fallback={"작성된 임시 화면 "}>
  {" "}
  <Main />{" "}
</Suspense>
```

불러오는 방법은 `Suspense 컴포넌트를` 리액트에서 꺼내오기
이때 `lazy` 로 불러온 `main` 컴포넌트를 자식 컴포넌트로 설정해주자.

---

## 3. 번들링 ( Bundling)

### 번들링을 해야하는 이유는 ?

1. HTTP 요청의 수를 줄여 속도 향상
2. 코드 압축하여 파일 크기 축소
3. 사용되지 않는 코드 제거하여 최적화 -> 사용하지 않는 코드를 분석하여 제거해줌

### 번들링 하는 방법

우리는 vite로 프로젝트를 생성해서 `Rollup` 프로그램을 사용하여 번들링이 된다.
`npm run build` 하면 `dist` 파일이 생성 -> 요것이 **번들링 완료 된 파일**

---

## 4. 코드 스플리팅 ( Code Splitting ) = lazy & Suspense도 대표적인 코드 스플리팅 방법 !

번들링의 반대로 모아놨던 코드를 쪼개는 의미

### 코드 스플리팅 하는 이유는 ?

**1. 초기 로딩 속도 개선 **-> 번들링을 하게 되면, 하나의 파일에 어마어마한 코드들이 들어있어서 초기에 로딩 속도가 길어짐 ! 그래서 딱 필요한 코드만 골라내어 코드 분할
**2. 불필요한 코드 로드 방지** -> 나름 여과 과정 거치긴 했지만, 끝까지 안쓰는 코드 있을 수 있음 , 필요한 부분만 작게 나눠서 사용
**3. 데이터 비용 절감**

> 중요한건 코드 스플리팅을 따로 하는 것이 아닌, "번들링" 을 먼저 선행 작업 하고 , 코드 스플리팅을 하는 것

### Vite,에서 코드 스플리팅 설정하기

lazy & Suspense 로 컴포넌트 단위로 코드 스플리티을 진행 = 필요한 부분만 화면에 랜더링이 되도록 !
근데 , 이런 컴포넌트 이외의 것들도 코드 스플리팅 적용이 될까?
세팅 방법에 대해 알아보자

```jsx
export default defineConfig({
  plugins: [react()],
  build: {
    rollupOptions: {
      output: {
        // Option 2: Function form for more dynamic control (e.g., all node_modules)
        manualChunks(id) {
          if (id.includes("node_modules")) {
            return "vendor"; // Bundle all node_modules into a 'vendor' chunk
          }
        },
      },
    },
  },
});
```

> ## 질문
>
> 동적 로딩 최적화에서 lazy로 필요한 컴포넌트만 불러오고 , suspense로 임시 화면을 보여주었는데 ,,,, 이 작업을 언제 많이 사용하는지?? 용량이 큰 이미지 파일을 불러오기 할 때에도 이 메서드들을 사요하나요?
